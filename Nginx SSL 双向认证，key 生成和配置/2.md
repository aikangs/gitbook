# SSL 服务器 / 客户端双向验证证书的生成

> * 创建一个新的 CA 根证书，在 nginx 安装目录下新建 ca 文件夹，进入 ca，创建几个子文件夹

```bash
mkdir ca && cd ca
mkdir newcerts private conf server
# newcerts 子目录将用于存放 CA 签署过的数字证书(证书备份目录)；private 用于存放 CA 的私钥；conf 目录用于存放一些简化参数用的配置文件；server 存放服务器证书文件。
```

> * conf 目录新建 openssl.conf 文件

```bash
[ ca ]
default_ca      = foo                   # The default ca section

[ foo ]
dir            = ./         # top dir
database       = ./index.txt          # index file.
new_certs_dir  = ./newcerts           # new certs dir

certificate    = ./private/ca.crt         # The CA cert
serial         = ./serial             # serial no file
private_key    = ./private/ca.key  # CA private key
RANDFILE       = ./private/.rand      # random number file

default_days   = 365                     # how long to certify for
default_crl_days= 30                     # how long before next CRL
default_md     = sha1                     # message digest method to use
unique_subject = no                      # Set to 'no' to allow creation of
                                         # several ctificates with same subject.
policy         = policy_any              # default policy

[ policy_any ]
countryName = match
stateOrProvinceName = match
organizationName = match
organizationalUnitName = match
localityName            = optional
commonName              = supplied
emailAddress            = optional
```
> * 生成私钥 key 文件

```bash
openssl genrsa -out private/ca.key 2048
输出
Generating RSA private key, 2048 bit long modulus
.......+++
.........................+++
e is 65537 (0x10001)
private 目录下有 ca.key 文件生成。
```

> * 生成证书请求 csr 文件

```bash
openssl req -new -key private/ca.key -out private/ca.csr
```

> * 生成凭证 crt 文件

```bash
openssl x509 -req -days 365 -in private/ca.csr -signkey private/ca.key -out private/ca.crt
private 目录下有 ca.crt 文件生成。
```

> * 为我们的 key 设置起始序列号和创建 CA 键库

```bash
echo FACE > serial
#可以是任意四个字符
touch index.txt
```
> * 为 “用户证书” 的移除创建一个证书撤销列表

```bash
openssl ca -gencrl -out ./private/ca.crl -crldays 7 -config "./conf/openssl.conf"
# 输出
Using configuration from ./conf/openssl.conf
private 目录下有 ca.crl 文件生成。
```




